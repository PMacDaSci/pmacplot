<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stream Graph • pmacplot</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Stream Graph">
<meta property="og:description" content="pmacplot">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pmacplot</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">PMACPLOT</a>
    </li>
    <li>
      <a href="../articles/piechart.html">Pie Chart</a>
    </li>
    <li>
      <a href="../articles/streamgraph.html">Stream Graph</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="streamgraph_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="streamgraph_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="streamgraph_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Stream Graph</h1>
                        <h4 class="author">Sebastian Hollizeck, Dawson Labs</h4>
            
            <h4 class="date">2020-11-19</h4>
      
      
      <div class="hidden name"><code>streamgraph.Rmd</code></div>

    </div>

    
    
<p><em>Level: Advanced</em></p>
<p>This shows how to create a stream graph using base R, such as the one in <a href="https://www.sciencedirect.com/science/article/pii/S1556086420300277#fig1">Figure 1B</a> <span class="citation">(Solomon et al. 2020)</span>. The graph shows the allele frequencies of a founder fusion mutation and G810 substitution mutations that emerged over time.</p>
<p><img src="streamgraph_files/figure-html/streamgraph-1.png" width="700"></p>
<div id="example-data" class="section level2">
<h2 class="hasAnchor">
<a href="#example-data" class="anchor"></a>Example data</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://r-datatable.com">data.table</a></span><span class="op">)</span>
<span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2018-3-9"</span>,<span class="st">"2018-3-29"</span>,<span class="st">"2018-5-10"</span>,<span class="st">"2018-6-18"</span>,<span class="st">"2018-7-17"</span>,<span class="st">"2018-9-5"</span><span class="op">)</span><span class="op">)</span>
<span class="va">fusion</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>date<span class="op">=</span><span class="va">dates</span>,vaf<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">22.1</span>,<span class="fl">3.8</span>,<span class="fl">4.6</span>,<span class="fl">2.4</span>,<span class="fl">5</span>,<span class="fl">25.4</span><span class="op">)</span>,var<span class="op">=</span><span class="st">"fusion"</span><span class="op">)</span>
<span class="va">G810R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>date<span class="op">=</span><span class="va">dates</span>,vaf<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">6.8</span><span class="op">)</span>,var<span class="op">=</span><span class="st">"G810R"</span><span class="op">)</span>
<span class="va">G810C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>date<span class="op">=</span><span class="va">dates</span>,vaf<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">2.1</span>,<span class="fl">4.8</span><span class="op">)</span>,var<span class="op">=</span><span class="st">"G810C"</span><span class="op">)</span>
<span class="va">G810V</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>date<span class="op">=</span><span class="va">dates</span>,vaf<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.3</span>,<span class="fl">0.2</span><span class="op">)</span>,var<span class="op">=</span><span class="st">"G810V"</span><span class="op">)</span>
<span class="va">G810S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>date<span class="op">=</span><span class="va">dates</span>,vaf<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.3</span>,<span class="fl">2.5</span>,<span class="fl">0</span><span class="op">)</span>,var<span class="op">=</span><span class="st">"G810S"</span><span class="op">)</span>

<span class="co">#lets make this one big data frame, so we have an easier time</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>g810r<span class="op">=</span><span class="va">G810R</span><span class="op">$</span><span class="va">vaf</span>,g810s<span class="op">=</span><span class="va">G810S</span><span class="op">$</span><span class="va">vaf</span>,g810c<span class="op">=</span><span class="va">G810C</span><span class="op">$</span><span class="va">vaf</span>,fusion<span class="op">=</span><span class="va">fusion</span><span class="op">$</span><span class="va">vaf</span>,g810v<span class="op">=</span><span class="va">G810V</span><span class="op">$</span><span class="va">vaf</span>,date<span class="op">=</span><span class="va">dates</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#take a look</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></code></pre></div>
<pre><code>##    g810r g810s g810c fusion g810v       date
## 1:   0.0   0.0   0.0   22.1   0.0 2018-03-09
## 2:   0.0   0.0   0.0    3.8   0.0 2018-03-29
## 3:   0.0   0.0   0.0    4.6   0.0 2018-05-10
## 4:   0.0   0.3   0.0    2.4   0.0 2018-06-18
## 5:   0.0   2.5   2.1    5.0   0.3 2018-07-17
## 6:   6.8   0.0   4.8   25.4   0.2 2018-09-05</code></pre>
</div>
<div id="stream-graph-function" class="section level2">
<h2 class="hasAnchor">
<a href="#stream-graph-function" class="anchor"></a>Stream graph function</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plotStreamGraph</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">=</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"No data, NO PLOT, also no cape!"</span><span class="op">)</span>, <span class="va">smoothed</span><span class="op">=</span><span class="cn">TRUE</span>, <span class="va">start</span><span class="op">=</span><span class="cn">TRUE</span>, <span class="va">dates</span><span class="op">=</span><span class="st">"date"</span>, <span class="va">colors</span><span class="op">=</span><span class="cn">NULL</span>, <span class="va">span</span><span class="op">=</span><span class="fl">0.6</span><span class="op">)</span><span class="op">{</span>

  <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://r-datatable.com">data.table</a></span><span class="op">)</span>
  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>

  <span class="co">#lets check first, if there is a date column in there</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span> <span class="va">dates</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="co">#well this is a problem</span>
    <span class="co">#maybe check if there is a date type column in there?</span>
    <span class="va">date_columns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">data</span>,<span class="va">class</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Date"</span><span class="op">)</span>

    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">date_columns</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span>
      <span class="co">#well without dates, we will have to assume the measurements are unidistant</span>
      <span class="va">data</span><span class="op">$</span><span class="va">TotalDays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fl">30</span><span class="op">)</span>

    <span class="op">}</span><span class="kw">else</span><span class="op">{</span>
      <span class="co">#we just take the first one and be happy</span>
      <span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">date_columns</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
      <span class="va">data</span><span class="op">$</span><span class="va">TotalDays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="va">..dates</span><span class="op">]</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>,<span class="va">..dates</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span><span class="kw">else</span><span class="op">{</span>
    <span class="co"># check if this is actually a date</span>
    <span class="co">#TODO</span>

    <span class="co">#and then convert this to actually usable x values by substracting the first value from all the others</span>
    <span class="co"># TODO: sorting?</span>
    <span class="co">#we set this as interger, so we can later exclude it easier</span>
    <span class="va">data</span><span class="op">$</span><span class="va">TotalDays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="va">..dates</span><span class="op">]</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>,<span class="va">..dates</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

  <span class="op">}</span>

  <span class="co">#now that this is sorted we get to the good part</span>

  <span class="kw">if</span><span class="op">(</span><span class="va">smoothed</span><span class="op">)</span><span class="op">{</span>
    <span class="co">#fit a loess model with each column</span>
    <span class="co">#but only keep numerical columns</span>
    <span class="va">keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">data</span>,<span class="va">class</span><span class="op">)</span><span class="op">==</span><span class="st">"numeric"</span><span class="op">)</span>
    <span class="va">loess_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="va">..keep</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/loess.html">loess</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">~</span><span class="va">data</span><span class="op">$</span><span class="va">TotalDays</span>,span<span class="op">=</span><span class="va">span</span><span class="op">)</span><span class="op">)</span>

    <span class="co">#now we interpolate for all days between the the measurements</span>
    <span class="va">interpSteps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">TotalDays</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, to<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">TotalDays</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>

    <span class="va">interpData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">loess_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">interpSteps</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

    <span class="co">#now negative occurances do not make sense with this</span>
    <span class="va">interpData</span><span class="op">[</span><span class="va">interpData</span><span class="op">&lt;</span><span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>

    <span class="va">plotData</span> <span class="op">&lt;-</span> <span class="va">interpData</span>
    <span class="va">plotX</span> <span class="op">&lt;-</span> <span class="va">interpSteps</span>

  <span class="op">}</span><span class="kw">else</span><span class="op">{</span>
    <span class="co">#if there is no smoothing, we just copy the raw data</span>
    <span class="va">plotData</span> <span class="op">&lt;-</span><span class="va">data</span><span class="op">[</span>,<span class="va">..keep</span><span class="op">]</span>
    <span class="va">plotX</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">TotalDays</span>
  <span class="op">}</span>
  <span class="co"># now we also need and X value for each point</span>

  <span class="kw">if</span><span class="op">(</span><span class="va">start</span><span class="op">)</span><span class="op">{</span>

    <span class="kw">if</span><span class="op">(</span><span class="va">smoothed</span><span class="op">)</span><span class="op">{</span>
      <span class="co">#now this is a bit of a hassle</span>
      <span class="co">#first we create a general outline of the way the thing should run</span>
      <span class="co"># we basically simulate a decay function</span>
      <span class="va">startValues</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">plotData</span><span class="op">)</span><span class="op">)</span>, <span class="co"># 0 is the endpoint</span>
                                         <span class="va">plotData</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">/</span><span class="fl">91</span>,
                                         <span class="va">plotData</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">/</span><span class="fl">27</span>,
                                         <span class="va">plotData</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">/</span><span class="fl">9</span>,
                                         <span class="va">plotData</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">/</span><span class="fl">3</span>,
                                         <span class="va">plotData</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">*</span><span class="fl">0.8</span>,
                                         <span class="va">plotData</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">*</span><span class="fl">0.9</span>,
                                         <span class="va">plotData</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>,
                                       byrow <span class="op">=</span> <span class="cn">TRUE</span>, nrow<span class="op">=</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="co">#and we have 8 time points to consider</span>

      <span class="co">#this is our backbone and now we smooth this,</span>
      <span class="va">loess_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">startValues</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/loess.html">loess</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">startValues</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

      <span class="co">#here we just interpolate a lot of points in between</span>
      <span class="va">smooth_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">loess_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">x</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">1</span>,to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">startValues</span><span class="op">)</span>,by<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

      <span class="co">#find out the first time 0 appears and set everything to 0 afterwards</span>
      <span class="va">smooth_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">smooth_start</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">x</span><span class="op">&lt;=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>
        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
      <span class="op">}</span><span class="op">)</span>

      <span class="co">#now we combine the start with the actual data</span>
      <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">smooth_start</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">plotData</span><span class="op">)</span>

      <span class="co">#now you trim a bit of, so the breakpoint is not as obvious</span>
      <span class="va">smooth_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">smooth_start</span>,n<span class="op">=</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span>
      <span class="co">#and then average over the breakpoint</span>

      <span class="va">breakIndex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">smooth_start</span><span class="op">)</span>
      <span class="va">smooth_start</span><span class="op">[</span><span class="va">breakIndex</span><span class="op">-</span><span class="fl">2</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">smooth_start</span>,<span class="fl">3</span><span class="op">)</span>,<span class="va">plotData</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span>
      <span class="va">smooth_start</span><span class="op">[</span><span class="va">breakIndex</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">smooth_start</span>,<span class="fl">2</span><span class="op">)</span>,<span class="va">plotData</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span>
      <span class="va">smooth_start</span><span class="op">[</span><span class="va">breakIndex</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">smooth_start</span>,<span class="fl">1</span><span class="op">)</span>,<span class="va">plotData</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span>

      <span class="co">#now we combine that into one</span>
      <span class="va">plotData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="va">smooth_start</span>, <span class="va">plotData</span><span class="op">)</span>

      <span class="co">#and obviously add some more xValues that need to be plotted</span>
      <span class="va">startX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="op">-</span><span class="fl">0.1</span>,by<span class="op">=</span><span class="op">-</span><span class="fl">0.3</span>, length.out<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">smooth_start</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

      <span class="va">plotX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">startX</span>, <span class="va">plotX</span><span class="op">)</span>

    <span class="op">}</span><span class="kw">else</span><span class="op">{</span>
      <span class="co">#just connect everything with the 0 line</span>

      <span class="va">zeroes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">plotData</span><span class="op">)</span><span class="op">)</span>
      <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">zeroes</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">plotData</span><span class="op">)</span>
      <span class="va">plotData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span> <span class="va">zeroes</span><span class="op">)</span>, <span class="va">plotData</span><span class="op">)</span>
      <span class="va">plotX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>,<span class="va">plotX</span><span class="op">)</span>
    <span class="op">}</span>

  <span class="op">}</span><span class="kw">else</span><span class="op">{</span>
    <span class="co">#no start means no work :)</span>
  <span class="op">}</span>


  <span class="co"># now for the plotting</span>

  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">colors</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span>
    <span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">plotData</span><span class="op">)</span>,<span class="st">"Set3"</span><span class="op">)</span>

  <span class="op">}</span>

  <span class="va">plotData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">plotData</span><span class="op">)</span>

  <span class="co">#we change the margins a bit and move the axis to where we want.</span>
  <span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mar"</span>,<span class="st">"mgp"</span>,<span class="st">"cex"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5.1</span>,<span class="fl">2.9</span>,<span class="fl">2.1</span>,<span class="fl">1.1</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.4</span>,<span class="fl">0.5</span>,<span class="fl">0</span><span class="op">)</span>,cex<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span>

  <span class="co">#then we plot the data.</span>
  <span class="fu">.plot.stream</span><span class="op">(</span><span class="va">plotX</span>, <span class="va">plotData</span>, axes<span class="op">=</span><span class="cn">FALSE</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">plotX</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">plotX</span><span class="op">)</span><span class="op">)</span>, center<span class="op">=</span><span class="cn">TRUE</span>,  spar<span class="op">=</span><span class="fl">0</span>, frac.rand<span class="op">=</span><span class="fl">0</span>, col<span class="op">=</span><span class="va">colors</span>, border<span class="op">=</span><span class="st">"white"</span>, lwd<span class="op">=</span><span class="fl">0.1</span>, xlab<span class="op">=</span><span class="st">""</span>, ylab<span class="op">=</span><span class="st">"allele frequency"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>xlab<span class="op">=</span><span class="st">"time [months]"</span>, mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>

  <span class="co">#add in the horizontal lines to show when the real data was taken</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">pos</span> <span class="kw">in</span> <span class="va">data</span><span class="op">$</span><span class="va">TotalDays</span><span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">pos</span>, lty<span class="op">=</span><span class="fl">3</span>, col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="co"># this is the y axis, but in ruler style with small ticks</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">2</span>,at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>,<span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span>, labels<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span><span class="op">)</span>, line<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/rug.html">rug</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">10</span><span class="op">:</span><span class="fl">9</span> <span class="op">+</span> <span class="fl">0.5</span>, ticksize <span class="op">=</span> <span class="op">-</span><span class="fl">0.01</span>, side <span class="op">=</span> <span class="fl">2</span>, line<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span>

  <span class="co">#now this is the xaxis</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">1</span>,at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">0</span>,to<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">TotalDays</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">]</span>,by<span class="op">=</span><span class="fl">30</span><span class="op">)</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">0</span>,to<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">TotalDays</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">]</span><span class="op">/</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span>

  <span class="co">#and of course we add a legend</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottom"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">plotData</span><span class="op">)</span>, fill<span class="op">=</span><span class="va">colors</span>, border<span class="op">=</span><span class="st">"white"</span>,bty<span class="op">=</span><span class="st">"n"</span>, ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">plotData</span><span class="op">)</span><span class="op">)</span>, cex<span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span>
<span class="op">}</span>


<span class="va">.plot.stream</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span>
  <span class="va">x</span>, <span class="va">y</span>,
  <span class="va">order.method</span> <span class="op">=</span> <span class="st">"as.is"</span>, <span class="va">frac.rand</span><span class="op">=</span><span class="fl">0.1</span>, <span class="va">spar</span><span class="op">=</span><span class="fl">0.2</span>,
  <span class="va">center</span><span class="op">=</span><span class="cn">TRUE</span>,
  <span class="va">ylab</span><span class="op">=</span><span class="st">""</span>, <span class="va">xlab</span><span class="op">=</span><span class="st">""</span>,
  <span class="va">border</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">lwd</span><span class="op">=</span><span class="fl">1</span>,
  <span class="va">col</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">rainbow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span>,
  <span class="va">ylim</span><span class="op">=</span><span class="cn">NULL</span>,
  <span class="va">...</span>
<span class="op">)</span><span class="op">{</span>

  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu">error</span><span class="op">(</span><span class="st">"y cannot contain negative numbers"</span><span class="op">)</span>

  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">border</span><span class="op">)</span><span class="op">)</span> <span class="va">border</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="st">"fg"</span><span class="op">)</span>
  <span class="va">border</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">border</span>, nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">col</span>, nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="va">lwd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">lwd</span>, nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>

  <span class="kw">if</span><span class="op">(</span><span class="va">order.method</span> <span class="op">==</span> <span class="st">"max"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">y</span>, <span class="fl">2</span>, <span class="va">which.max</span><span class="op">)</span><span class="op">)</span>
    <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span>, <span class="va">ord</span><span class="op">]</span>
    <span class="va">col</span> <span class="op">&lt;-</span> <span class="va">col</span><span class="op">[</span><span class="va">ord</span><span class="op">]</span>
    <span class="va">border</span> <span class="op">&lt;-</span> <span class="va">border</span><span class="op">[</span><span class="va">ord</span><span class="op">]</span>
  <span class="op">}</span>

  <span class="kw">if</span><span class="op">(</span><span class="va">order.method</span> <span class="op">==</span> <span class="st">"first"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">y</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">r</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span>, <span class="va">ord</span><span class="op">]</span>
    <span class="va">col</span> <span class="op">&lt;-</span> <span class="va">col</span><span class="op">[</span><span class="va">ord</span><span class="op">]</span>
    <span class="va">border</span> <span class="op">&lt;-</span> <span class="va">border</span><span class="op">[</span><span class="va">ord</span><span class="op">]</span>
  <span class="op">}</span>

  <span class="va">bottom.old</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">*</span><span class="fl">0</span>
  <span class="va">top.old</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">*</span><span class="fl">0</span>
  <span class="va">polys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>mode<span class="op">=</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">polys</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op">%%</span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span> <span class="co">#if odd</span>
      <span class="va">top.new</span> <span class="op">&lt;-</span> <span class="va">top.old</span> <span class="op">+</span> <span class="va">y</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>
      <span class="va">polys</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">top.old</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">top.new</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
      <span class="va">top.old</span> <span class="op">&lt;-</span> <span class="va">top.new</span>
    <span class="op">}</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op">%%</span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="co">#if even</span>
      <span class="va">bottom.new</span> <span class="op">&lt;-</span> <span class="va">bottom.old</span> <span class="op">-</span> <span class="va">y</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>
      <span class="va">polys</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">bottom.old</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">bottom.new</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
      <span class="va">bottom.old</span> <span class="op">&lt;-</span> <span class="va">bottom.new</span>
    <span class="op">}</span>
  <span class="op">}</span>

  <span class="va">ylim.tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">polys</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">y</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">outer.lims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">polys</span>, <span class="kw">function</span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">r</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">r</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">r</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="va">mid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">outer.lims</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">r</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">r</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

  <span class="co">#center and wiggle</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">center</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">g0</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">mid</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, min<span class="op">=</span><span class="va">frac.rand</span><span class="op">*</span><span class="va">ylim.tmp</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, max<span class="op">=</span><span class="va">frac.rand</span><span class="op">*</span><span class="va">ylim.tmp</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="va">g0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, min<span class="op">=</span><span class="va">frac.rand</span><span class="op">*</span><span class="va">ylim.tmp</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, max<span class="op">=</span><span class="va">frac.rand</span><span class="op">*</span><span class="va">ylim.tmp</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/smooth.spline.html">smooth.spline</a></span><span class="op">(</span><span class="va">g0</span> <span class="op">~</span> <span class="va">x</span>, spar<span class="op">=</span><span class="va">spar</span><span class="op">)</span>

  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">polys</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">polys</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">polys</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">y</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">ylim</span><span class="op">)</span><span class="op">)</span> <span class="va">ylim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">polys</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">y</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, ylab<span class="op">=</span><span class="va">ylab</span>, xlab<span class="op">=</span><span class="va">xlab</span>, ylim<span class="op">=</span><span class="va">ylim</span>, t<span class="op">=</span><span class="st">"n"</span>, <span class="va">...</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">polys</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span><span class="op">(</span><span class="va">polys</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, border<span class="op">=</span><span class="va">border</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, lwd<span class="op">=</span><span class="va">lwd</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>

<span class="op">}</span></code></pre></div>
</div>
<div id="plot-stream-graph" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-stream-graph" class="anchor"></a>Plot Stream graph</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plotStreamGraph</span><span class="op">(</span><span class="va">y</span><span class="op">)</span></code></pre></div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-Solomon2020">
<p>Solomon, Benjamin J., Lavinia Tan, Jessica J. Lin, Stephen Q. Wong, Sebastian Hollizeck, Kevin Ebata, Brian B. Tuch, et al. 2020. “RET Solvent Front Mutations Mediate Acquired Resistance to Selective RET Inhibition in RET-Driven Malignancies.” <em>Journal of Thoracic Oncology</em> 15 (4): 541–49. <a href="https://doi.org/10.1016/j.jtho.2020.01.006">https://doi.org/10.1016/j.jtho.2020.01.006</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Maria Doyle.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
